<div class="row" ng-hide="loadingData || !data || data.length == 0">
  <div class="col-sm-12 text-center spacing pb-4" id="measure">
    <linear-lifetime data="data"
                     zoom-y="zoomY"
                     human-readable-numbers="humanReadable"
                     big-number-formatter="formatBigNumber"
                     class="spacing"><div class="historical-drilldown" id="historical-drilldown"></div></linear-lifetime>
    <div ng-if="listSubmitted.length != 0">
      <p class="mt-4">
        List of requests (<b>{{listSubmitted.length}}</b>) in status <b>submitted</b>
      </p>
      <div class="row small-padding">
        <div class="col-sm-2">
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('prepid')">
            <i ng-if="sortSubmittedOn != 'prepid'" class="fa fa-sort-amount-asc spacing-r" title="Click to sort ascending by prepid"></i>
            <i ng-if="sortSubmittedOn == 'prepid' && sortSubmittedOrder == 1" class="fa fa-sort-amount-asc spacing-r sort-selected" title="Click to sort descending by prepid"></i>
            <i ng-if="sortSubmittedOn == 'prepid' && sortSubmittedOrder == -1" class="fa fa-sort-amount-desc spacing-r sort-selected" title="Click to sort ascending by prepid"></i>
          </button>
        </div>
        <div class="col-sm-2">
          <!-- Events -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('done')">
            <i ng-if="sortSubmittedOn != 'done'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by done events"></i>
            <i ng-if="sortSubmittedOn == 'done' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by done events"></i>
            <i ng-if="sortSubmittedOn == 'done' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by done events"></i>
          </button>
          /
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('expected')">
            <i ng-if="sortSubmittedOn != 'expected'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by expected events"></i>
            <i ng-if="sortSubmittedOn == 'expected' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by expected events"></i>
            <i ng-if="sortSubmittedOn == 'expected' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by expected events"></i>
          </button>
        </div>
        <div class="col-sm-2">
          <!-- Lumisections -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('done_lumis')">
            <i ng-if="sortSubmittedOn != 'done_lumis'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by done lumisections"></i>
            <i ng-if="sortSubmittedOn == 'done_lumis' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by done lumisections"></i>
            <i ng-if="sortSubmittedOn == 'done_lumis' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by done lumisections"></i>
          </button>
          /
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('expected_lumis')">
            <i ng-if="sortSubmittedOn != 'expected_lumis'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by expected lumisections"></i>
            <i ng-if="sortSubmittedOn == 'expected_lumis' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by expected lumisections"></i>
            <i ng-if="sortSubmittedOn == 'expected_lumis' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by expected lumisections"></i>
          </button>
        </div>
        <div class="col-sm-1">
          <!-- Progress (Events) -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('percentage')">
            <i ng-if="sortSubmittedOn != 'percentage'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by progress (based on events)"></i>
            <i ng-if="sortSubmittedOn == 'percentage' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by progress (based on events)"></i>
            <i ng-if="sortSubmittedOn == 'percentage' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by progress (based on events)"></i>
          </button>
        </div>
        <div class="col-sm-1">
          <!-- Progress (Lumisections) -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('percentageLumis')">
            <i ng-if="sortSubmittedOn != 'percentageLumis'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by progress (based on lumis)"></i>
            <i ng-if="sortSubmittedOn == 'percentageLumis' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by progress (based on lumis)"></i>
            <i ng-if="sortSubmittedOn == 'percentageLumis' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by progress (based on lumis)"></i>
          </button>
        </div>
        <div class="col-sm-2">
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('workflowTimestamp')">
            <i ng-if="sortSubmittedOn != 'workflowTimestamp'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by time in current workflow status"></i>
            <i ng-if="sortSubmittedOn == 'workflowTimestamp' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by time in current workflow status"></i>
            <i ng-if="sortSubmittedOn == 'workflowTimestamp' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by time in current workflow status"></i>
          </button>
        </div>
        <div class="col-sm-1">
          <button type="button" class="btn btn-sort m-2" ng-click="changeSubmittedSort('priority')">
            <i ng-if="sortSubmittedOn != 'priority'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by priority"></i>
            <i ng-if="sortSubmittedOn == 'priority' && sortSubmittedOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by priority"></i>
            <i ng-if="sortSubmittedOn == 'priority' && sortSubmittedOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by priority"></i>
          </button>
        </div>
      </div>
      <div ng-repeat="submitted in listSubmitted" class="row zebra-lines small-padding">
        <div class="col-sm-2">
          <a ng-href="{{submitted.url}}" target="_blank">{{submitted.prepid}}</a>
          <br><small>{{submitted.dataset}}</small>
          <small title="Number of events estimated from {{submitted.estimate_from}}" style="color:red" ng-if="submitted.estimate_from"><br>(Estimate from {{submitted.estimate_from}})</small>
        </div>
        <div class="col-sm-2">
          <small>Events:</small><br>
          <b title="{{submitted.done}}">{{humanReadable ? (submitted.done | readableNumbers) : submitted.done}}</b>
          <small title="Force completed" style="color:red" ng-if="submitted.force_completed">(FC)</small>
          /
          <b title="{{submitted.expected}}">{{humanReadable ? (submitted.expected | readableNumbers) : submitted.expected}}</b>
        </div>
        <div class="col-sm-2">
          <small>Lumisections:</small><br>
          <b title="{{submitted.done_lumis}}">{{humanReadable ? (submitted.done_lumis | readableNumbers) : submitted.done_lumis}}</b>
          <small title="Force completed" style="color:red" ng-if="submitted.force_completed">(FC)</small>
          /
          <b title="{{submitted.expected_lumis}}">{{humanReadable ? (submitted.expected_lumis | readableNumbers) : submitted.expected_lumis}}</b>
        </div>
        <div class="col-sm-1">
          <!-- Progress (on events) -->
          <small>Progress (events):</small><br>
          <div class="progress total-bar" ng-show="submitted.expected > 0">
            <div class="font-shadow progress-bar pmp-orange"
                 ng-class="{'pmp-red': submitted.output_dataset_status == 'INVALID' || submitted.output_dataset_status == 'DELETED',
                            'pmp-blue': submitted.output_dataset_status == 'VALID',
                            'pmp-orange': submitted.output_dataset_status == 'PRODUCTION'}"
                 role="progressbar"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 title="{{submitted.output_dataset}} is {{submitted.output_dataset_status}} at {{submitted.percentage | readableNumbers}}%"
                 style="color: black;
                        max-width: 100%;
                        width:{{submitted.percentage}}%;">
              {{submitted.percentage | readableNumbers}}%
            </div>
          </div>
        </div>
        <div class="col-sm-1">
          <!-- Progress (on lumisections) -->
          <small>Progress (lumis):</small><br>
          <div class="progress total-bar" ng-show="submitted.expected > 0">
            <div class="font-shadow progress-bar pmp-orange"
                 ng-class="{'pmp-red': submitted.output_dataset_status == 'INVALID' || submitted.output_dataset_status == 'DELETED',
                            'pmp-blue': submitted.output_dataset_status == 'VALID',
                            'pmp-orange': submitted.output_dataset_status == 'PRODUCTION'}"
                 role="progressbar"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 title="{{submitted.output_dataset}} is {{submitted.output_dataset_status}} at {{submitted.percentageLumis | readableNumbers}}%"
                 style="color: black;
                        max-width: 100%;
                        width:{{submitted.percentageLumis}}%;">
              {{submitted.percentageLumis | readableNumbers}}%
            </div>
          </div>
        </div>
        <div class="col-sm-2">
          <small>In <b>{{submitted.workflowStatus}}</b> for:</small><br>
          <b>{{submitted.workflowTimestampDiff}}</b>
        </div>
        <div class="col-sm-1">
          <small>Priority:</small><br>
          <b>{{submitted.priority}}</b>
        </div>
        <div class="col-sm-1">
          <a ng-if="submitted.output_dataset" ng-href="https://cmsweb.cern.ch/das/request?view=list&limit=50&instance=prod/global&input=dataset={{submitted.output_dataset}}" target="_blank" title="Output dataset on DAS">DAS</a>
          <a ng-if="submitted.workflow" ng-href="https://cms-pdmv.cern.ch/stats?workflow_name={{submitted.workflow}}" target="_blank" title="Workflow in Stats">Stats</a>
          <a ng-href="/pmp/historical?r={{submitted.prepid}}" target="_blank" title="Historical plot of {{submitted.prepid}}">pMp</a>
        </div>
      </div>
      <div style="text-align: right;">
        <a style="cursor: pointer" ng-click="makeCSV(listSubmitted)">Download as CSV</a>
      </div>
    </div>

    <div ng-if="showDoneRequestsList && listDone.length != 0">
      <p class="mt-4">
        List of requests (<b>{{listDone.length}}</b>) in status <b>done</b>
      </p>
      <div class="row small-padding">
        <div class="col-sm-2">
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('prepid')">
            <i ng-if="sortDoneOn != 'prepid'" class="fa fa-sort-amount-asc spacing-r" title="Click to sort ascending by prepid"></i>
            <i ng-if="sortDoneOn == 'prepid' && sortDoneOrder == 1" class="fa fa-sort-amount-asc spacing-r sort-selected" title="Click to sort descending by prepid"></i>
            <i ng-if="sortDoneOn == 'prepid' && sortDoneOrder == -1" class="fa fa-sort-amount-desc spacing-r sort-selected" title="Click to sort ascending by prepid"></i>
          </button>
        </div>
        <div class="col-sm-2">
          <!-- Events -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('done')">
            <i ng-if="sortDoneOn != 'done'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by done events"></i>
            <i ng-if="sortDoneOn == 'done' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by done events"></i>
            <i ng-if="sortDoneOn == 'done' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by done events"></i>
          </button>
          /
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('expected')">
            <i ng-if="sortDoneOn != 'expected'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by expected events"></i>
            <i ng-if="sortDoneOn == 'expected' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by expected events"></i>
            <i ng-if="sortDoneOn == 'expected' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by expected events"></i>
          </button>
        </div>
        <div class="col-sm-2">
          <!-- Lumisections -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('done_lumis')">
            <i ng-if="sortDoneOn != 'done_lumis'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by done lumisections"></i>
            <i ng-if="sortDoneOn == 'done_lumis' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by done lumisections"></i>
            <i ng-if="sortDoneOn == 'done_lumis' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by done lumisections"></i>
          </button>
          /
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('expected_lumis')">
            <i ng-if="sortDoneOn != 'expected_lumis'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by expected lumisections"></i>
            <i ng-if="sortDoneOn == 'expected_lumis' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by expected lumisections"></i>
            <i ng-if="sortDoneOn == 'expected_lumis' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by expected lumisections"></i>
          </button>
        </div>
        <div class="col-sm-1">
          <!-- Progress (Events) -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('percentage')">
            <i ng-if="sortDoneOn != 'percentage'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by progress (based on events)"></i>
            <i ng-if="sortDoneOn == 'percentage' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by progress (based on events)"></i>
            <i ng-if="sortDoneOn == 'percentage' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by progress (based on events)"></i>
          </button>
        </div>
        <div class="col-sm-1">
          <!-- Progress (Lumisections) -->
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('percentageLumis')">
            <i ng-if="sortDoneOn != 'percentageLumis'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by progress (based on lumis)"></i>
            <i ng-if="sortDoneOn == 'percentageLumis' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by progress (based on lumis)"></i>
            <i ng-if="sortDoneOn == 'percentageLumis' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by progress (based on lumis)"></i>
          </button>
        </div>
        <div class="col-sm-2">
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('statusTimestamp')">
            <i ng-if="sortDoneOn != 'statusTimestamp'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by time in done status"></i>
            <i ng-if="sortDoneOn == 'statusTimestamp' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by time in done status"></i>
            <i ng-if="sortDoneOn == 'statusTimestamp' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by time in done status"></i>
          </button>
        </div>
        <div class="col-sm-1">
          <button type="button" class="btn btn-sort m-2" ng-click="changeDoneSort('priority')">
            <i ng-if="sortDoneOn != 'priority'" class="fa fa-sort-numeric-asc spacing-r" title="Click to sort ascending by priority"></i>
            <i ng-if="sortDoneOn == 'priority' && sortDoneOrder == 1" class="fa fa-sort-numeric-asc spacing-r sort-selected" title="Click to sort descending by priority"></i>
            <i ng-if="sortDoneOn == 'priority' && sortDoneOrder == -1" class="fa fa-sort-numeric-desc spacing-r sort-selected" title="Click to sort ascending by priority"></i>
          </button>
        </div>
      </div>
      <div ng-repeat="done in listDone" class="row zebra-lines small-padding">
        <div class="col-sm-2">
          <a ng-href="{{done.url}}" target="_blank">{{done.prepid}}</a>
          <br><small>{{done.dataset}}</small>
          <small title="Number of events estimated from {{done.estimate_from}}" style="color:red" ng-if="done.estimate_from"><br>(Estimate from {{done.estimate_from}})</small>
        </div>
        <div class="col-sm-2">
          <small>Events:</small><br>
          <b title="{{done.done}}">{{humanReadable ? (done.done | readableNumbers) : done.done}}</b>
          <small title="Force completed" style="color:red" ng-if="done.force_completed">(FC)</small>
          /
          <b title="{{done.expected}}">{{humanReadable ? (done.expected | readableNumbers) : done.expected}}</b>
        </div>
        <div class="col-sm-2">
          <small>Lumisections:</small><br>
          <b title="{{done.done_lumis}}">{{humanReadable ? (done.done_lumis | readableNumbers) : done.done_lumis}}</b>
          <small title="Force completed" style="color:red" ng-if="done.force_completed">(FC)</small>
          /
          <b title="{{done.expected_lumis}}">{{humanReadable ? (done.expected_lumis | readableNumbers) : done.expected_lumis}}</b>
        </div>
        <div class="col-sm-1">
          <!-- Progress (on events) -->
          <small>Progress:</small><br>
          <div class="progress total-bar" ng-show="done.expected > 0">
            <div class="font-shadow progress-bar pmp-blue"
                 ng-class="{'pmp-red': done.output_dataset_status == 'INVALID' || done.output_dataset_status == 'DELETED',
                            'pmp-blue': done.output_dataset_status == 'VALID',
                            'pmp-orange': done.output_dataset_status == 'PRODUCTION'}"
                 role="progressbar"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 title="{{done.output_dataset}} is {{done.output_dataset_status}} at {{done.percentage | readableNumbers}}%"
                 style="color: black;
                        max-width: 100%;
                        width:{{done.percentage}}%;">
              {{done.percentage | readableNumbers}}%
            </div>
          </div>
        </div>
        <div class="col-sm-1">
          <!-- Progress (on lumisections) -->
          <small>Progress:</small><br>
          <div class="progress total-bar" ng-show="done.expected > 0">
            <div class="font-shadow progress-bar pmp-blue"
                 ng-class="{'pmp-red': done.output_dataset_status == 'INVALID' || done.output_dataset_status == 'DELETED',
                            'pmp-blue': done.output_dataset_status == 'VALID',
                            'pmp-orange': done.output_dataset_status == 'PRODUCTION'}"
                 role="progressbar"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 title="{{done.output_dataset}} is {{done.output_dataset_status}} at {{done.percentageLumis | readableNumbers}}%"
                 style="color: black;
                        max-width: 100%;
                        width:{{done.percentageLumis}}%;">
              {{done.percentageLumis | readableNumbers}}%
            </div>
          </div>
        </div>
        <div class="col-sm-2">
          <small>Done for:</small><br>
          <b>{{done.statusTimestampDiff}}</b>
        </div>
        <div class="col-sm-1">
          <small>Priority:</small><br>
          <b>{{done.priority}}</b>
        </div>
        <div class="col-sm-1">
          <a ng-if="done.output_dataset" ng-href="https://cmsweb.cern.ch/das/request?view=list&limit=50&instance=prod/global&input=dataset={{done.output_dataset}}" target="_blank" title="Output dataset on DAS">DAS</a>
          <a ng-if="done.workflow" ng-href="https://cms-pdmv.cern.ch/stats?workflow_name={{done.workflow}}" target="_blank" title="Workflow in Stats">Stats</a>
          <a ng-href="/pmp/historical?r={{done.prepid}}" target="_blank" title="Historical plot of {{done.prepid}}">pMp</a>
        </div>
      </div>
      <div style="text-align: right;">
        <a style="cursor: pointer" ng-click="makeCSV(listDone)">Download as CSV</a>
      </div>
    </div>
  </div>
</div>
